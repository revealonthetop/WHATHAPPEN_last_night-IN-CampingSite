<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>돌 피하기 게임</title>
    <link rel="stylesheet" type="text/css" href="AvoidStones.css">
</head>

<body>
    <div>
        <canvas id="canvas" width="800" height="600"></canvas>
        <div id="scoreBoard">
            <h1>점수판</h1>
        </div>
    </div>
    <script type="module">
        let canvas;
        let ctx;
        let canvasBuffer;
        let bufferCtx;
        let threadSpeed = 16;
        let sx, sy, sw = 60, sh = 35;
        let angle = 0;
        let speedX = 0;
        let speedY = 0;
        const rotationSpeed = 0.2;
        const acceleration = 1;
        const friction = 0.98;
        let spaceshipImage;

        function loadImage() {
            spaceshipImage = new Image();
            spaceshipImage.src = "spaceship.png";
            spaceshipImage.onload = function () {
                initialize();
            };
        }

        function handleKeyEvents() {
            window.addEventListener('keydown', (event) => {
                switch (event.keyCode) {
                    case 37: // 왼쪽 화살표 키
                        angle -= rotationSpeed; // 좌회전
                        break;
                    case 39: // 오른쪽 화살표 키
                        angle += rotationSpeed; // 우회전
                        break;
                    case 38: // 위쪽 화살표 키
                        // 앞으로 가는 속도 증가
                        speedX += Math.cos(angle) * acceleration;
                        speedY += Math.sin(angle) * acceleration;
                        break;
                    case 40: // 아래쪽 화살표 키
                        // 뒤로 가는 속도 증가
                        speedX -= Math.cos(angle) * acceleration;
                        speedY -= Math.sin(angle) * acceleration;
                        break;
                }
            });
        }

        function updateSpaceshipPosition() {
            sx += speedX;
            sy += speedY;
            speedX *= friction;
            speedY *= friction;
        }

        function drawSpaceship() {
            ctx.save(); // 현재 그리기 상태 저장
            ctx.translate(sx, sy); // 우주선의 위치로 이동
            ctx.rotate(angle); // 우주선의 각도로 회전

            // 이미지 그리기
            ctx.drawImage(spaceshipImage, -sw / 2, -sh / 2, sw, sh);

            ctx.restore(); // 이전 그리기 상태 복원
        }

        function update() {
            updateSpaceshipPosition();
            drawSpaceship();
        }

        function initialize() {
            canvas = document.getElementById('canvas');
            if (canvas == null || canvas.getContext == null)
                return;
            ctx = canvas.getContext('2d');

            canvasBuffer = document.createElement('canvas');
            canvasBuffer.width = canvas.width;
            canvasBuffer.height = canvas.height;
            bufferCtx = canvasBuffer.getContext('2d');

            handleKeyEvents();

            // 반복 동작 설정
            setInterval(update, threadSpeed);
        }

        // 게임 시작 시 이미지 로딩 호출
        window.addEventListener('load', loadImage);
    </script>
    <script type="module" src="/AvoidStones.js"></script>
</body>

</html>